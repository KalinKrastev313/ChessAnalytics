{% extends 'base.html' %}
{% block content %}
    <script>
        function openEngineSettingsForm() {
            const evalContainer = document.getElementById('evaluateButton');
            const formContainer = document.getElementById('formContainer');

            if (formContainer.style.display === 'none') {
                formContainer.style.display = 'block';
                evalContainer.style.display = 'none';
            }
            {#const evalContainer = document.getElementById('evaluateButton')#}
            {##}
            {#const engineSettingsForm = '{% csrf_token %}{{ form.as_p }}'#}
            {##}
            {#evalContainer.innerHTML = '<form method="post">' + engineSettingsForm + '<button type="submit">Submit</button></form>';#}

        }
    </script>
    <main class="wrapper">
        <div class="board">
            {% for square_data in position.squares_data %}
                <div class="{{ square_data.color }}">
                    {% if square_data.occupied_by %}
                        <img src="{{ square_data.occupied_by }}">
                    {% endif %}
                </div>
            {% endfor %}

            {#        Old help code code bellow if you need to refactor the squares of the template when using squares dict instead of squares data#}
            {#for row in range(8):#}
            {#    for col in range(1, 9, 1):#}
            {#        square = f"{chr(96 + col)}{8 - row}"#}
            {#        print(#}
            {#            f'<div class="{{{{ position.squares_dict.{square}.color }}}}" >'#}
            {#            f'\n{{% if position.squares_dict.{square}.occupied_by %}}'#}
            {#            f'\n<img src="{{{{ position.squares_dict.{square}.occupied_by }}}}">'#}
            {#            f'\n{{% endif %}}'#}
            {#            f'\n</div>')#}

        </div>
        <details>
            <p>White Player:</p>
            <p>Black Player:</p>
            <p>Tournament:</p>

            {% if position.evaluation %}
                <p>Evaluation: {{ position.evaluation }}</p>
            {% else %}
                <div id="evaluateButton" onclick="openEngineSettingsForm()">Evaluate</div>
                <div id="formContainer" style="display: none;">
                    <form id="engineSettingsForm" method="post">
                        {% csrf_token %}
                        {{ form.as_p }}
                        <input type="hidden" name="pk" value="{{ position.pk }}">
                        <button type="submit">Submit</button>
                    </form>
                </div>
                {#                <form id="evaluateForm" method="post" action="{% url 'position evaluate' %}">#}
                {#                    {% csrf_token %}#}
                {#                    <input type="hidden" name="pk" value="{{ position.pk }}">#}
                {#                    <input type="number" name="depth">#}
                {#                    <button type="submit">Evaluate</button>#}
                {#                </form>#}
            {% endif %}

            <p>Side to move:
                {% if position.is_white_to_move %}
                    White
                {% else %}
                    Black
                {% endif %}
            </p>
        </details>
    </main>

{% endblock %}